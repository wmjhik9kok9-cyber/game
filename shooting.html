<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²åŒ–ã™ã‚‹ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</title>
    <style>
        body { margin: 0; padding: 0; background-color: #111; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        canvas { 
            border: 2px solid #555; 
            /* å®‡å®™ã£ã½ã„èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
            background: radial-gradient(circle, #1a1a2e 0%, #000000 100%);
            width: 100%; max-width: 400px; height: auto; aspect-ratio: 9 / 16; 
            cursor: pointer;
        }
        .back-btn { position: absolute; top: 10px; left: 10px; text-decoration: none; background: rgba(255,255,255,0.8); color: #333; padding: 5px 10px; border-radius: 5px; font-size: 12px; z-index: 10; }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">â¬… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸</a>
    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = 360;
    canvas.height = 640;

    // --- è¨­å®š ---
    const PLAYER_EMOJI = "ğŸš€";
    const ENEMY_EMOJI = "ğŸ‘¾";

    // ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹
    let gameState = "START"; 
    let score = 0;
    let frameCount = 0;

    // ãƒ¬ãƒ™ãƒ«ç®¡ç†å¤‰æ•°
    let enemySpeedBase = 3;     // æ•µã®è½ã¡ã‚‹é€Ÿã•
    let enemySpawnRate = 60;    // æ•µãŒå‡ºã‚‹é–“éš”ï¼ˆå°ã•ã„ã»ã©é »ç¹ã«å‡ºã‚‹ï¼‰
    let bulletInterval = 25;    // å¼¾ã®é€£å°„é€Ÿåº¦
    
    // ç¾åœ¨ã®å¼¾ã®ã‚¹ãƒšãƒƒã‚¯ï¼ˆãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã§å¤‰åŒ–ï¼‰
    let currentBullet = {
        emoji: "ğŸ”¥",
        speed: 10,
        size: 30
    };

    const player = { x: canvas.width / 2 - 20, y: canvas.height - 60, width: 40, height: 40 };
    let bullets = [];
    let enemies = [];

    // --- æ“ä½œç³» ---
    function updatePlayerPos(clientX) {
        if (gameState !== "PLAYING") return;
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        player.x = (clientX - rect.left) * scaleX - player.width / 2;
    }
    document.addEventListener("mousemove", (e) => updatePlayerPos(e.clientX));
    document.addEventListener("touchmove", (e) => { e.preventDefault(); updatePlayerPos(e.touches[0].clientX); }, { passive: false });

    canvas.addEventListener("click", () => {
        if (gameState === "START" || gameState === "GAMEOVER") gameStart();
    });

    // --- ã‚²ãƒ¼ãƒ é€²è¡Œ ---
    function gameStart() {
        gameState = "PLAYING";
        score = 0;
        frameCount = 0;
        
        // é›£æ˜“åº¦ãƒªã‚»ãƒƒãƒˆ
        enemySpeedBase = 3;
        enemySpawnRate = 60;
        bulletInterval = 25;
        currentBullet = { emoji: "ğŸ”¥", speed: 10, size: 30 };

        bullets = [];
        enemies = [];
        player.x = canvas.width / 2 - player.width / 2;
    }

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (gameState === "START") drawStartScreen();
        else if (gameState === "PLAYING") {
            update();
            drawGame();
        } else if (gameState === "GAMEOVER") {
            drawGame();
            drawGameOverScreen();
        }
        requestAnimationFrame(gameLoop);
    }

    function update() {
        frameCount++;
        checkLevelUp(); // â˜…ã“ã“ã§ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—åˆ¤å®šï¼

        // å¼¾ã®ç™ºå°„
        if (frameCount % bulletInterval === 0) {
            bullets.push({ 
                x: player.x + player.width/2 - currentBullet.size/2, // ä¸­å¤®ã‹ã‚‰
                y: player.y - 20, 
                width: currentBullet.size, 
                height: currentBullet.size,
                emoji: currentBullet.emoji, // â˜…ç™ºå°„æ™‚ã®è¦‹ãŸç›®ã‚’ä¿å­˜
                speed: currentBullet.speed  // â˜…ç™ºå°„æ™‚ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ä¿å­˜
            });
        }

        // å¼¾ã®ç§»å‹•
        bullets.forEach((b, i) => {
            b.y -= b.speed;
            if (b.y + b.height < 0) bullets.splice(i, 1);
        });

        // æ•µã®å‡ºç¾ï¼ˆspawnRateãŒå°ã•ããªã‚‹ã»ã©å¤§é‡ã«å‡ºã‚‹ï¼ï¼‰
        if (frameCount % enemySpawnRate === 0) {
            const size = Math.random() * 20 + 30; 
            enemies.push({ 
                x: Math.random() * (canvas.width - size),
                y: -size, 
                width: size, height: size,
                speed: enemySpeedBase + Math.random()
            });
        }

        // æ•µã®ç§»å‹•ãƒ»åˆ¤å®š
        enemies.forEach((e, i) => {
            e.y += e.speed;
            if (e.y > canvas.height - 30) gameState = "GAMEOVER";
            if (checkCollision(player, e)) gameState = "GAMEOVER";
            
            bullets.forEach((b, j) => {
                if (checkCollision(e, b)) {
                    enemies.splice(i, 1);
                    bullets.splice(j, 1);
                    score += 100;
                }
            });
        });
    }

    // â˜…ä»Šå›ã®ç›®ç‰æ©Ÿèƒ½ï¼šãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ 
    function checkLevelUp() {
        // 1. æ•µã®å‡ºç¾æ•°ã‚¢ãƒƒãƒ—ï¼ˆ500ç‚¹ã”ã¨ã«é–“éš”ãŒçŸ­ããªã‚‹ï¼‰
        // åˆæœŸ60ãƒ•ãƒ¬ãƒ¼ãƒ (1ç§’) -> æœ€é€Ÿ15ãƒ•ãƒ¬ãƒ¼ãƒ (0.25ç§’)ã¾ã§çŸ­ç¸®
        enemySpawnRate = Math.max(15, 60 - Math.floor(score / 500) * 5);

        // 2. æ•µã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—
        enemySpeedBase = 3 + Math.floor(score / 500) * 0.5;

        // 3. æ­¦å™¨ã®é€²åŒ–ï¼ˆè¦‹ãŸç›®ã¨æ€§èƒ½å¤‰åŒ–ï¼‰
        if (score >= 3000) {
            // Lv3: ã‚¹ã‚¿ãƒ¼å¼¾ï¼ˆé«˜é€Ÿãƒ»å·¨å¤§ï¼‰
            currentBullet.emoji = "ğŸŒŸ";
            currentBullet.speed = 18;
            currentBullet.size = 50; 
            bulletInterval = 10; // è¶…é€£å°„
        } else if (score >= 1000) {
            // Lv2: ç¨²å¦»å¼¾ï¼ˆé«˜é€Ÿï¼‰
            currentBullet.emoji = "âš¡";
            currentBullet.speed = 15;
            currentBullet.size = 35;
            bulletInterval = 18; // æ—©ã‚ã®é€£å°„
        } else {
            // Lv1: ãƒ•ã‚¡ã‚¤ã‚¢å¼¾
            currentBullet.emoji = "ğŸ”¥";
            currentBullet.speed = 10;
            currentBullet.size = 30;
            bulletInterval = 25; // æ™®é€š
        }
    }

    function checkCollision(rect1, rect2) {
        const padding = rect1.width * 0.2; 
        return (
            rect1.x + padding < rect2.x + rect2.width - padding &&
            rect1.x + rect1.width - padding > rect2.x + padding &&
            rect1.y + padding < rect2.y + rect2.height - padding &&
            rect1.y + rect1.height - padding > rect2.y + padding
        );
    }

    function drawEmoji(emoji, x, y, w, h) {
        ctx.font = `${h}px sans-serif`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(emoji, x + w / 2, y + h / 2);
    }

    function drawStartScreen() {
        ctx.fillStyle = "#fff"; ctx.textAlign = "center";
        ctx.font = "bold 40px Arial";
        ctx.fillText("SHOOTING", canvas.width / 2, canvas.height / 3);
        ctx.fillStyle = "#e67e22";
        ctx.fillRect(canvas.width/2 - 100, canvas.height/2, 200, 60);
        ctx.fillStyle = "#fff"; ctx.font = "bold 24px Arial";
        ctx.fillText("TAP TO START", canvas.width / 2, canvas.height/2 + 38);
        drawEmoji(PLAYER_EMOJI, canvas.width/2 - 25, canvas.height - 100, 50, 50);
    }

    function drawGameOverScreen() {
        ctx.fillStyle = "rgba(0,0,0,0.7)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#fff"; ctx.textAlign = "center";
        ctx.font = "bold 40px Arial";
        ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 3);
        ctx.font = "20px Arial";
        ctx.fillText("Score: " + score, canvas.width / 2, canvas.height / 3 + 50);
        ctx.fillStyle = "#f1c40f";
        ctx.fillRect(canvas.width/2 - 80, canvas.height/2 + 20, 160, 50);
        ctx.fillStyle = "#000"; ctx.font = "bold 20px Arial";
        ctx.fillText("RETRY", canvas.width / 2, canvas.height/2 + 52);
    }

    function drawGame() {
        drawEmoji(PLAYER_EMOJI, player.x, player.y, player.width, player.height);
        // å¼¾ï¼ˆä¿å­˜ã•ã‚ŒãŸãã‚Œãã‚Œã®è¦‹ãŸç›®ã§æç”»ï¼‰
        bullets.forEach(b => drawEmoji(b.emoji, b.x, b.y, b.width, b.height));
        // æ•µ
        enemies.forEach(e => drawEmoji(ENEMY_EMOJI, e.x, e.y, e.width, e.height));

        // ã‚¹ã‚³ã‚¢
        ctx.fillStyle = "#fff"; ctx.font = "bold 20px Arial";
        ctx.textAlign = "left";
        ctx.fillText("Score: " + score, 10, 30);
    }

    gameLoop();

</script>
</body>
</html>